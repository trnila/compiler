<?xml version="1.0" encoding="UTF-8"?>
<project name="lang" default="jar">
	<property file="build.properties"/>

	<condition property="javacc.home" value="/usr/share/java/javacc/">
		<not>
			<isset property="javacc.home"/>
		</not>
	</condition>

	<target name="clean">
		<delete dir="build"/>
	</target>

	<target name="javacc">
		<mkdir dir="build/autogenerated" />
		<javacc target="src/lang/parser/lang.jj" outputdirectory="build/autogenerated" javacchome="${javacc.home}"/>
	</target>

	<target name="compile" depends="javacc">
		<mkdir dir="build/classes"/>
		<javac destdir="build/classes">
			<src path="build/autogenerated" />
			<src path="src" />
		</javac>
	</target>

	<target name="jar" depends="compile">
		<mkdir dir="build/jar"/>
		<jar destfile="build/jar/langcompiler.jar" basedir="build/classes">
			<manifest>
				<attribute name="Main-Class" value="lang.Main"/>
			</manifest>
		</jar>
	</target>

	<target name="junit" depends="compile">
		<junit haltonfailure="yes" printsummary="on" showoutput="on">
			<classpath>
				<pathelement location="./build/classes"/>
				<fileset dir="./lib/" includes="junit-4.8.1.jar"/>
			</classpath>

			<formatter type="brief" usefile="false" />

			<test name="lang.test.TypeCheckingTest" />
		</junit>
	</target>

	<target name="test" depends="jar">
		<java jar="build/jar/langcompiler.jar" fork="true" args="tests/t1.txt" failonerror="true" />
		<java jar="build/jar/langcompiler.jar" fork="true" args="tests/t2.txt" failonerror="true" />
		<java jar="build/jar/langcompiler.jar" fork="true" args="tests/t3.txt" failonerror="true" />
		<java jar="build/jar/langcompiler.jar" fork="true" args="tests/exprs" failonerror="true" />
		<java jar="build/jar/langcompiler.jar" fork="true" args="tests/isPrime" failonerror="true" />
	</target>
</project>
